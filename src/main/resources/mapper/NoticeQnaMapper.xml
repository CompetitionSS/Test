<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- JAVA와 연결할 Mapper 파일 설정 -->
<mapper namespace="pcs.css.persistance.mapper.INoticeQnaMapper">

    <!-- 게시판 리스트 쿼리 -->
    <select id="getNoticeQnaList" resultType="NoticeQnaDTO">
        SELECT N.NOTICE_SEQ, N.TITLE, N.NOTICE_YN, N.READ_CNT, U.USER_ID, N.USER_ID

        FROM NOTICEQNA N, USERINFO U
        WHERE N.USER_ID = U.USER_ID
        ORDER BY N.NOTICE_YN, N.REG_DT DESC
    </select>

    <!-- 게시판 등록 쿼리 -->
    <insert id="InsertNoticeQnaInfo" parameterType="NoticeQnaDTO">
        INSERT INTO NOTICE
        (
            NOTICE_SEQ, TITLE, NOTICE_YN,READ_CNT,USER_ID,REG_DT, CONTENTS,
            REG_ID
        )
        VALUES(
                      (SELECT NVL(MAX(A.NOTICE_SEQ),0)+1 FROM NOTICE A),
                      #{title}, #{notice_yn},0,#{user_id},  SYSDATE, #{contents},#{user_id}
              )
    </insert>

    <!-- 게시판 상세보기 쿼리 -->
    <select id="getNoticeQnaInfo" resultType="NoticeQnaDTO">
        SELECT N.NOTICE_SEQ, N.TITLE, N.NOTICE_YN, N.READ_CNT, U.USER_NAME, N.USER_ID,
               CONTENTS, TO_CHAR(N.REG_DT, 'YYYY-MM-DD') AS REG_DT
        FROM NOTICE N, USERINFO U
        WHERE N.USER_ID = U.USER_ID
          AND N.NOTICE_SEQ = #{notice_seq}
    </select>



    <!-- 조회수 증가 쿼리 -->
    <update id="updateNoticeQnaReadCnt" parameterType="NoticeQnaDTO">
        UPDATE NOTICE SET
            READ_CNT = READ_CNT + 1
        WHERE
            NOTICE_SEQ = #{notice_seq}
    </update>

    <!-- 게시판 수정 쿼리 -->
    <update id="updateNoticeQnaInfo" parameterType="NoticeQnaDTO">
        UPDATE NOTICE SET
                          TITLE = #{title},
                          NOTICE_YN = #{notice_yn},
                          CONTENTS = #{contents}

        WHERE
            NOTICE_SEQ = #{notice_seq}

    </update>

    <!-- 게시판 삭제 쿼리 -->
    <delete id="deleteNoticeQnaInfo" parameterType="NoticeQnaDTO">
        DELETE FROM NOTICE
        WHERE NOTICE_SEQ = #{notice_seq}

    </delete>

</mapper>